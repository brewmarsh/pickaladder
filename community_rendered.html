<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="token">
    <title>pickaladder - Community Hub</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Oswald:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="icon" href="/static/pickaladder_logo_64.png" type="image/png" sizes="64x64">
    <link rel="icon" href="/static/pickaladder_logo_128.png" type="image/png"
        sizes="128x128">
    <link rel="icon" href="/static/pickaladder_logo_256.png" type="image/png"
        sizes="256x256">
    <link rel="icon" href="/static/pickaladder_logo_512.png" type="image/png"
        sizes="512x512">
    <link rel="stylesheet" href="/static/css/variables.css">
    <link rel="stylesheet" href="/static/css/layout.css">
    <link rel="stylesheet" href="/static/css/components.css">
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="/static/dark.css">
    <link rel="stylesheet" href="/static/mobile.css">
</head>

<body >
    <header class="header">
    <div class="container">
        <nav class="navbar">
            <a href="/user.dashboard/" class="navbar-brand" style="display: flex; align-items: center;">
                <img src="/static/pickaladder_logo_64.png" alt="pickaladder logo"
                    style="height: 24px; margin-right: 8px;">
                pickaladder
            </a>
            <div class="navbar-menu">

                <a href="/user.dashboard/"
                    class="nav-link ">üìà Dashboard</a>
                <a href="/user.view_community/"
                    class="nav-link "
                    style="position: relative;">
                    üåç Community

                </a>
                <a href="/group.view_groups/"
                    class="nav-link ">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Groups</a>
                <a href="/tournament.list_tournaments/"
                    class="nav-link "
                    style="position: relative;">
                    üéæ Tournaments

                </a>
                <a href="/match.leaderboard/"
                    class="nav-link ">üèÜ Global Leaderboard</a>

            </div>
            <div class="navbar-user-controls">

                <div class="dropdown">
                    <button class="dropbtn">
                        <img src="" alt="Profile Picture" class="avatar avatar-sm"
                            onerror="this.onerror=null;this.src='/static/user_icon.png';">
                    </button>
                    <div class="dropdown-content">
                        <a href="/user.view_user/test_user">üë§ My Profile</a>
                        <a href="/auth.change_password/">üîë Settings / Change Password</a>

                        <div class="dropdown-divider"></div>
                        <a href="/auth.logout/">üö™ Logout</a>
                    </div>
                </div>

                <button class="hamburger-menu">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </nav>
    </div>
</header>
    <div class="container">
        <main class="main-content">





<div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="mb-0">Community Hub</h1>
    <button id="invite-friend-btn" class="btn btn-primary w-auto" data-csrf="token">Invite a Friend</button>
</div>
<div id="invite-success-message" class="alert alert-success" style="display: none;"></div>



<div class="card card-notification incoming-requests-section" style="margin-bottom: 40px;">
    <h3>Pending Friend Requests <span class="badge badge-volt">2</span></h3>
    <div class="table-container">
        <table class="table-standard responsive-table">
            <thead>
                <tr>
                    <th>User</th>
                    <th style="text-align: right;">Actions</th>
                </tr>
            </thead>
            <tbody>

                <tr>
                    <td data-label="Username">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <img src="/static/user_icon.png" alt="ghost@example.com" class="avatar avatar-md">
                            <a href="/user.view_user/1">

                                    ghost@example.com

                            </a>
                        </div>
                    </td>
                    <td data-label="Actions" style="text-align: right;">
                        <form action="/user.accept_request/1" method="post"
                            style="display: inline;">
                            <input type="hidden" name="csrf_token" value="token">
                            <button type="submit" class="btn btn-success">Accept</button>
                        </form>
                        <form action="/user.cancel_request/1" method="post"
                            style="display: inline;">
                            <input type="hidden" name="csrf_token" value="token">
                            <button type="submit" class="btn btn-outline-danger"
                                onclick="return confirm('Are you sure you want to decline this friend request?');">Decline</button>
                        </form>
                    </td>
                </tr>

                <tr>
                    <td data-label="Username">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <img src="/static/user_icon.png" alt="normal_user" class="avatar avatar-md">
                            <a href="/user.view_user/2">

                                    normal_user

                            </a>
                        </div>
                    </td>
                    <td data-label="Actions" style="text-align: right;">
                        <form action="/user.accept_request/2" method="post"
                            style="display: inline;">
                            <input type="hidden" name="csrf_token" value="token">
                            <button type="submit" class="btn btn-success">Accept</button>
                        </form>
                        <form action="/user.cancel_request/2" method="post"
                            style="display: inline;">
                            <input type="hidden" name="csrf_token" value="token">
                            <button type="submit" class="btn btn-outline-danger"
                                onclick="return confirm('Are you sure you want to decline this friend request?');">Decline</button>
                        </form>
                    </td>
                </tr>

            </tbody>
        </table>
    </div>
</div>



<div class="mx-auto mb-4" style="max-width: 600px;">
    <form method="get" action="/user.view_community/" class="search-form">
        <div class="input-group">
            <input type="text" name="search" class="form-control" placeholder="Search by username, name, or email" value="">
            <div class="input-group-append">
                <button type="submit" class="btn btn-primary">üîç</button>

            </div>
        </div>
    </form>
</div>



<div class="card requests-section" style="margin-top: 40px;">
    <h3>Sent Friend Requests</h3>
    <div class="table-container">
        <table class="table-standard responsive-table">
            <thead>
                <tr>
                    <th>User</th>
                    <th style="text-align: right;">Actions</th>
                </tr>
            </thead>
            <tbody>

                <tr>
                    <td data-label="User">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <img src="/static/user_icon.png" alt="sent_ghost@example.com" class="avatar avatar-md">
                            <a href="/user.view_user/3"><strong>

                                    sent_ghost@example.com

                            </strong></a>
                        </div>
                    </td>
                    <td data-label="Actions" style="text-align: right;">
                        <form action="/user.cancel_request/3" method="post">
                            <input type="hidden" name="csrf_token" value="token">
                            <button type="submit" class="btn btn-outline-danger btn-sm"
                                onclick="return confirm('Are you sure you want to cancel this friend request?');">Cancel</button>
                        </form>
                    </td>
                </tr>

            </tbody>
        </table>
    </div>
</div>





<div class="friends-section" style="margin-bottom: 40px;">
    <h3>Your Friends</h3>

    <div class="friend-grid">

        <div class="friend-card card-action">
            <a href="/user.view_user/4" class="friend-card-link">
                <div class="friend-card-content">
                    <img src="/static/user_icon.png" alt="friend1" class="avatar avatar-lg">
                    <h3 class="friend-name">

                            Friend One

                    </h3>

                    <p class="text-muted" style="margin-top: -5px; font-size: 0.85em;">@friend1</p>

                    <div class="friend-rating">
                        <span class="star-icon">‚≠ê</span>
                        <span class="dupr-value">N/A</span>
                    </div>
                </div>
            </a>
            <div class="friend-card-actions">
                <a href="/match.record_match/4"
                    class="btn btn-volt challenge-btn">Challenge</a>
            </div>
        </div>

        <div class="friend-card card-action">
            <a href="/user.view_user/5" class="friend-card-link">
                <div class="friend-card-content">
                    <img src="/static/user_icon.png" alt="ghost_friend@example.com" class="avatar avatar-lg">
                    <h3 class="friend-name">

                            ghost_friend@example.com

                    </h3>

                    <div class="friend-rating">
                        <span class="star-icon">‚≠ê</span>
                        <span class="dupr-value">N/A</span>
                    </div>
                </div>
            </a>
            <div class="friend-card-actions">
                <a href="/match.record_match/5"
                    class="btn btn-volt challenge-btn">Challenge</a>
            </div>
        </div>

    </div>

</div>

<div class="discover-section" style="margin-bottom: 40px;">
    <h3>Discover Players</h3>

    <div class="friend-grid">

        <div class="friend-card card-action">
            <a href="/user.view_user/6" class="friend-card-link">
                <div class="friend-card-content">
                    <img src="/static/user_icon.png" alt="other1" class="avatar avatar-lg">
                    <h3 class="friend-name">

                            other1

                    </h3>

                    <div class="friend-rating">
                        <span class="star-icon">‚≠ê</span>
                        <span class="dupr-value">N/A</span>
                    </div>
                </div>
            </a>
            <div class="friend-card-actions">
                <form method="post" action="/user.send_friend_request/6">
                    <input type="hidden" name="csrf_token" value="token">
                    <button type="submit" class="btn add-friend-btn">Add Friend</button>
                </form>
            </div>
        </div>

        <div class="friend-card card-action">
            <a href="/user.view_user/7" class="friend-card-link">
                <div class="friend-card-content">
                    <img src="/static/user_icon.png" alt="ghost_other@example.com" class="avatar avatar-lg">
                    <h3 class="friend-name">

                            ghost_other@example.com

                    </h3>

                    <div class="friend-rating">
                        <span class="star-icon">‚≠ê</span>
                        <span class="dupr-value">N/A</span>
                    </div>
                </div>
            </a>
            <div class="friend-card-actions">
                <form method="post" action="/user.send_friend_request/7">
                    <input type="hidden" name="csrf_token" value="token">
                    <button type="submit" class="btn add-friend-btn">Add Friend</button>
                </form>
            </div>
        </div>

    </div>

</div>

<div class="groups-section">
    <h3>Find Groups</h3>

    <div class="table-container">
        <table class="table-standard responsive-table">
            <thead>
                <tr>
                    <th></th>
                    <th>Group Name</th>
                    <th>Owner</th>
                    <th>Description</th>
                    <th style="text-align: right;">Actions</th>
                </tr>
            </thead>
            <tbody>

                <tr>
                    <td data-label="Logo">
                        <img src="/static/user_icon.png"
                            alt="Group Logo" class="avatar avatar-md">
                    </td>
                    <td data-label="Group Name">
                        <a href="/group.view_group/g1"><strong>Group 1</strong></a>
                    </td>
                    <td data-label="Owner">

                            owner@example.com

                    </td>
                    <td data-label="Description"><small></small></td>
                    <td data-label="Actions" class="actions-cell" style="text-align: right;">
                        <form action="/group.join_group/g1" method="post"
                            style="display: inline;">
                            <input type="hidden" name="csrf_token" value="token">
                            <button type="submit" class="btn">Join</button>
                        </form>
                    </td>
                </tr>

            </tbody>
        </table>
    </div>

</div>


        </main>
    </div>

    <footer class="footer mt-auto py-3">
    <div class="container text-center">
        <span class="text-muted">
            &copy;  Pick-A-Ladder
            <span class="mx-2">|</span>
            vdev
        </span>
    </div>
</footer>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        $(document).ready(function () {
            $('.toast').toast('show');
        });

        function showToast(message, category = 'info', submissionId = null) {
            const toastContainer = document.querySelector('.toast-container');
            if (!toastContainer) return;

            const toastId = submissionId || `toast_${Date.now()}`;
            const autohide = category !== 'info'; // Don't autohide pending toasts
            const delay = 5000;

            let progressBar = '';
            if (category === 'info') {
                progressBar = '<div class="progress"><div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 100%"></div></div>';
            }

            const toastHTML = `
                <div class="toast" id="${toastId}" role="alert" aria-live="assertive" aria-atomic="true" ${autohide ? `data-delay="${delay}" data-autohide="true"` : ''}>
                    <div class="toast-header">
                        <img src="/static/pickaladder_logo_64.png" class="rounded mr-2" alt="Logo" style="width: 20px; height: 20px;">
                        <strong class="mr-auto">pickaladder</strong>
                        <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="toast-body">
                        ${message}
                        ${progressBar}
                    </div>
                </div>
            `;
            toastContainer.insertAdjacentHTML('beforeend', toastHTML);
            const newToast = document.getElementById(toastId);
            $(newToast).toast('show');
            return toastId;
        }

        function updateToast(toastId, message, category) {
            const toastElement = document.getElementById(toastId);
            if (!toastElement) return;

            const toastBody = toastElement.querySelector('.toast-body');

            // Remove progress bar
            const progressBar = toastBody.querySelector('.progress');
            if (progressBar) {
                progressBar.remove();
            }

            toastBody.innerHTML = message;

            // Add a retry button for failed submissions
            if (category === 'danger') {
                const retryButton = document.createElement('button');
                retryButton.className = 'btn btn-sm btn-link';
                retryButton.innerText = 'Retry';
                retryButton.onclick = function () {
                    window.optimisticSubmission.retrySubmission(toastId);
                };
                toastBody.appendChild(document.createElement('br'));
                toastBody.appendChild(retryButton);
            }

            $(toastElement).data('autohide', true);
            $(toastElement).data('delay', 5000);

            // Hack to restart the autohide timer
            $(toastElement).toast('hide');
            $(toastElement).toast('show');
        }

        document.addEventListener("click", (e) => {
            const row = e.target.closest(".clickable-row");
            if (row && row.dataset.href && !e.target.closest("a") && !e.target.closest("button") && !e.target.closest("input")) {
                window.location.href = row.dataset.href;
            }
        });

        const hamburger = document.querySelector('.hamburger-menu');
        if (hamburger) {
            hamburger.addEventListener('click', function () {
                document.querySelector('.dropdown-content').classList.toggle('active');
            });
        }
    </script>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "",
            authDomain: "pickaladder.firebaseapp.com",
            projectId: "pickaladder",
            storageBucket: "pickaladder.appspot.com",
            messagingSenderId: "402457219675",
            appId: "1:402457219675:web:a346e2dc0dfa732d31e57e",
            measurementId: "G-E28CXCXTSK"
        };
        // Intercept fetch to add the auth token
        const originalFetch = window.fetch;
        window.fetch = function (url, options) {
            const token = localStorage.getItem('firebaseIdToken');
            if (token) {
                options = options || {};
                options.headers = options.headers || {};
                options.headers['Authorization'] = 'Bearer ' + token;
            }
            return originalFetch(url, options);
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
    </script>


<script>
    document.addEventListener('DOMContentLoaded', function () {
        const inviteButton = document.getElementById('invite-friend-btn');
        const successMessage = document.getElementById('invite-success-message');

        const cannedMessages = [
            "Tired of losing? Me too. Join me on pickaladder and let's lose together!",
            "I found this cool app called pickaladder. It's like a ladder for pickleball, but with more losing.",
            "You've been officially challenged to a pickleball match. First, you have to join me on pickaladder.",
            "Let's settle this on the court. Join me on pickaladder.",
        ];

        if (inviteButton) {
            inviteButton.addEventListener('click', function () {
                const csrfToken = this.getAttribute('data-csrf');
                fetch("/user.create_invite/", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "X-CSRFToken": csrfToken,
                    },
                })
                    .then(response => response.json())
                    .then(data => {
                        const token = data.token;
                        const inviteUrl = new URL("/auth.register/True");
                        inviteUrl.searchParams.set('invite_token', token);

                        const randomMessage = cannedMessages[Math.floor(Math.random() * cannedMessages.length)];
                        const inviteText = `${randomMessage} ${inviteUrl.href}`;

                        if (navigator.clipboard) {
                            navigator.clipboard.writeText(inviteText).then(function () {
                                successMessage.textContent = 'Invite message copied to clipboard!';
                                successMessage.style.display = 'block';
                                setTimeout(() => {
                                    successMessage.style.display = 'none';
                                }, 3000);
                            }, function (err) {
                                console.error('Could not copy text: ', err);
                            });
                        } else {
                            const textArea = document.createElement("textarea");
                            textArea.value = inviteText;
                            document.body.appendChild(textArea);
                            textArea.focus();
                            textArea.select();
                            try {
                                document.execCommand('copy');
                                successMessage.textContent = 'Invite message copied to clipboard!';
                                successMessage.style.display = 'block';
                                setTimeout(() => {
                                    successMessage.style.display = 'none';
                                }, 3000);
                            } catch (err) {
                                console.error('Fallback: Oops, unable to copy', err);
                            }
                            document.body.removeChild(textArea);
                        }
                    });
            });
        }

        // AJAX for Add Friend buttons
        const addFriendBtns = document.querySelectorAll(".add-friend-btn");
        addFriendBtns.forEach(btn => {
            btn.addEventListener("click", (e) => {
                e.preventDefault();
                const form = btn.closest('form');
                const url = form.action;
                const csrfToken = form.querySelector('input[name="csrf_token"]').value;

                fetch(url, {
                    method: "POST",
                    headers: {
                        "X-Requested-With": "XMLHttpRequest",
                        "Content-Type": "application/json",
                        "X-CSRFToken": csrfToken
                    },
                    body: JSON.stringify({})
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            btn.textContent = "Request Sent";
                            btn.disabled = true;
                            btn.classList.remove('btn-primary');
                        } else {
                            alert(data.message || "An error occurred.");
                        }
                    })
                    .catch(error => {
                        console.error("Error:", error);
                        alert("An error occurred while sending the friend request.");
                    });
            });
        });
    });
</script>

</body>

</html>