services:
  web:
    image: ${IMAGE_TAG}
    restart: always
    ports:
      - "27272:27272"
    command: gunicorn --bind 0.0.0.0:27272 --timeout 120 app:app
    volumes:
      # Mount the credentials file from the host into the container
      - ./firebase-credentials.json:/app/firebase-credentials.json:ro
    environment:
      # GOOGLE_APPLICATION_CREDENTIALS should point to the path of the
      # service account key file, which will be loaded into the container.
      - GOOGLE_APPLICATION_CREDENTIALS=/app/firebase-credentials.json
      # These variables should be set in the production environment (e.g., GitHub Secrets)
      - SECRET_KEY=${SECRET_KEY}
      - MAIL_SERVER=${MAIL_SERVER}
      - MAIL_PORT=${MAIL_PORT}
      - MAIL_USE_TLS=${MAIL_USE_TLS}
      - MAIL_USERNAME=${MAIL_USERNAME}
      - MAIL_PASSWORD=${MAIL_PASSWORD}
      - FIREBASE_PROJECT_ID=${FIREBASE_PROJECT_ID}
    networks:
      - pickanet

networks:
  pickanet:
    driver: bridge