{% extends "layout.html" %}
{% block title %}Merge Ghost Account{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="page-header mb-4">
        <h1>Merge Ghost Account</h1>
    </div>

    <div class="card mb-4">
        <div class="card-body">
            <p class="text-muted">
                Use this tool to merge a ghost account (created during match recording) into a real user's profile.
                All match history and group memberships from the ghost account will be transferred to the real user, and the ghost account will be deleted.
            </p>
            <div class="alert alert-warning">
                <strong>Warning:</strong> This action is irreversible. The Ghost Account will be permanently deleted.
            </div>

            <form method="POST">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

                <div class="form-group">
                    <label for="ghost_user_id">Ghost Account (Source - Will be DELETED)</label>
                    <select name="ghost_user_id" id="ghost_user_id" class="form-control" required>
                        <option value="">-- Select Ghost Account --</option>
                        {% for ghost in ghosts %}
                            <option value="{{ ghost.id }}">
                                {{ ghost.username or ghost.name }} ({{ ghost.email or 'No email' }})
                            </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label for="target_user_id">Real User (Target - Will keep all data)</label>
                    <select name="target_user_id" id="target_user_id" class="form-control" required>
                        <option value="">-- Select Real User --</option>
                        {% for user in real_users %}
                            <option value="{{ user.id }}">
                                {{ user.username or user.name }} ({{ user.email or 'No email' }})
                            </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="mt-4">
                    <button type="submit" class="btn btn-danger btn-block" onclick="return confirm('Are you sure you want to merge these accounts? This cannot be undone.')">
                        Merge Ghost into Real User
                    </button>
                    <a href="{{ url_for('admin.admin') }}" class="btn btn-outline-secondary btn-block mt-2">Cancel</a>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
