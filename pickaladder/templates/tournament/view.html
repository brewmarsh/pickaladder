{% extends "layout.html" %}
{% block title %}{{ tournament.name }}{% endblock %}
{% block content %}

{% if claim_team_data %}
<div class="alert alert-info border-info shadow-sm mb-4" style="margin: 20px; padding: 20px; border-left: 5px solid var(--accent-color);">
    <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
        <div>
            <h4 class="alert-heading mb-1" style="color: var(--text-color);">ğŸ‘¥ Team Invitation</h4>
            <p class="mb-0"><strong>{{ claim_team_data.p1_name }}</strong> has invited you to join team <strong>"{{ claim_team_data.team_name }}"</strong> for this tournament!</p>
        </div>
        <form action="{{ url_for('.claim_team', tournament_id=tournament.id, team_id=claim_team_data.id) }}" method="POST">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit" class="btn btn-primary">Join Team</button>
        </form>
    </div>
</div>
{% endif %}

<div class="card hero-stats-card" style="
    background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('{{ tournament.banner_url or url_for('static', filename='court_bg.jpg') }}');
    background-size: cover;
    background-position: center;
    height: 300px;
    border-radius: var(--radius-lg);
    margin-bottom: 24px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    color: white;
    text-align: center;
    position: relative;
">
    {% if g.user.isAdmin %}
        <a href="{{ url_for('tournament.edit_tournament', tournament_id=tournament.id) }}" 
           class="btn-edit-gear" 
           style="position: absolute; top: 20px; right: 20px; font-size: 1.5rem; text-decoration: none;" 
           title="Edit Tournament">âš™ï¸</a>
    {% endif %}
    <h1 style="font-size: 3rem; text-shadow: 0 2px 4px rgba(0,0,0,1); margin-bottom: 0.5rem;">{{ tournament.name }}</h1>
    <p style="font-size: 1.25rem; text-shadow: 0 2px 4px rgba(0,0,0,1);">
        {{ tournament.date_display or tournament.date }} | {{ tournament.matchType|capitalize }}
    </p>
    <span class="badge {{ 'badge-success' if tournament.status == 'Completed' else 'badge-warning' }}" style="margin-top: 10px;">
        {{ tournament.status or 'Active' }}
    </span>

    {% set user_p = participants | selectattr('user_id', 'equalto', g.user.uid) | first %}
    {% if user_p and user_p.status == 'pending' %}
        <form action="{{ url_for('tournament.join_tournament', tournament_id=tournament.id) }}" method="POST" style="margin-top: 15px;">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit" class="btn btn-success shadow">Accept Invitation</button>
        </form>
    {% endif %}
</div>

<div class="dashboard-columns">
    <div class="dashboard-column-left">
        <div class="tabs">
            <button class="tab-btn active" onclick="openTab(event, 'overview')">Overview</button>
            <button class="tab-btn" onclick="openTab(event, 'bracket')">Bracket</button>
            <button class="tab-btn" onclick="openTab(event, 'players')">Players</button>
        </div>

        <div id="overview" class="tab-content">
            {% if tournament.description %}
            <div class="card">
                <h3 class="card-header">About Tournament</h3>
                <div style="white-space: pre-wrap;">{{ tournament.description }}</div>
            </div>
            {% endif %}

            {% if tournament.status == 'Completed' and podium %}
            <div class="card text-center">
                <h3 class="card-header">ğŸ† The Podium ğŸ†</h3>
                <div style="display: flex; justify-content: center; align-items: flex-end; gap: 20px; padding: 20px; flex-wrap: wrap;">
                    {% if podium|length > 1 %}
                    <div style="text-align: center; order: 1;">
                        <div style="font-size: 3rem;">ğŸ¥ˆ</div>
                        <div class="rank-badge rank-2" style="padding: 10px 20px; font-size: 1.2rem; border-radius: 10px; margin-bottom: 5px;">
                            {{ podium[1].name }}
                        </div>
                        <div class="text-muted">2nd Place</div>
                    </div>
                    {% endif %}

                    <div style="text-align: center; order: 0;">
                        <div style="font-size: 4rem;">ğŸ¥‡</div>
                        <div class="rank-badge rank-1" style="padding: 15px 30px; font-size: 1.5rem; border-radius: 10px; box-shadow: 0 0 15px var(--warning-color); margin-bottom: 5px;">
                            {{ podium[0].name }}
                        </div>
                        <div class="text-muted">Tournament Champion</div>
                    </div>

                    {% if podium|length > 2 %}
                    <div style="text-align: center; order: 2;">
                        <div style="font-size: 2.5rem;">ğŸ¥‰</div>
                        <div class="rank-badge rank-3" style="padding: 8px 15px; font-size: 1.1rem; border-radius: 10px; margin-bottom: 5px;">
                            {{ podium[2].name }}
                        </div>
                        <div class="text-muted">3rd Place</div>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}

            <div class="card">
                <div class="vanity-stats-container justify-content-center gap-4">
                    <div class="vanity-stat">
                        <div class="stat-value fs-3 fw-bold">{{ participants|length }}</div>
                        <div class="stat-label text-muted small">Participants</div>
                    </div>
                    <div class="vanity-stat">
                        <div class="stat-value fs-3 fw-bold">{{ tournament.matchType|capitalize }}</div>
                        <div class="stat-label text-muted small">Match Type</div>
                    </div>
                </div>
            </div>
        </div>

        <div id="bracket" class="tab-content" style="display: none;">
            </div>

        </div>
</div>