{% macro brand_logo() %}
<a href="{{ url_for('user.dashboard') }}" class="navbar-brand" style="display: flex; align-items: center;">
    <img src="{{ url_for('static', filename='pickaladder_logo_64.png') }}" alt="pickaladder logo"
        style="height: 24px; margin-right: 8px;">
    pickaladder
</a>
{% endmacro %}

<header class="header">
    <div class="container">
        <!-- Mobile Header -->
        <div class="d-flex justify-content-between align-items-center d-lg-none w-100">
            {{ brand_logo() }}
            <button class="hamburger-menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>

        <!-- Desktop Navbar -->
        <nav class="navbar d-none d-lg-flex">
            {{ brand_logo() }}
            <div class="navbar-menu">
                {% if g.user %}
                <a href="{{ url_for('user.dashboard') }}"
                    class="nav-link {{ 'active' if request.endpoint == 'user.dashboard' }}">ğŸ“ˆ Dashboard</a>
                <a href="{{ url_for('user.view_community') }}"
                    class="nav-link {{ 'active' if request.endpoint == 'user.view_community' }}"
                    style="position: relative;">
                    ğŸŒ Community
                    {% if incoming_requests_count > 0 %}
                    <span class="notification-badge">{{ incoming_requests_count }}</span>
                    {% endif %}
                </a>
                <a href="{{ url_for('group.view_groups') }}"
                    class="nav-link {{ 'active' if request.endpoint == 'group.view_groups' }}">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Groups</a>
                <a href="{{ url_for('tournament.list_tournaments') }}"
                    class="nav-link {{ 'active' if request.endpoint == 'tournament.list_tournaments' }}"
                    style="position: relative;">
                    ğŸ¾ Tournaments
                    {% if pending_tournament_invites %}
                    <span class="notification-badge">{{ pending_tournament_invites|length }}</span>
                    {% endif %}
                </a>
                {% if g.user.is_admin %}
                <a href="{{ url_for('tournament.create_tournament') }}"
                    class="nav-link {{ 'active' if request.endpoint == 'tournament.create_tournament' }}">â• New Tournament</a>
                {% endif %}
                <a href="{{ url_for('match.leaderboard') }}"
                    class="nav-link {{ 'active' if request.endpoint == 'match.leaderboard' }}">ğŸ† Leaderboard</a>
                {% else %}
                <div class="desktop-auth-buttons">
                    {% if request.endpoint != 'auth.login' %}
                    <a href="{{ url_for('auth.login') }}" class="btn">Login</a>
                    {% endif %}
                    <a href="{{ url_for('auth.register') }}" class="btn btn-primary">Register</a>
                </div>
                {% endif %}
            </div>
            <div class="navbar-user-controls">
                {% if g.user %}
                <div class="dropdown">
                    <button class="dropbtn">
                        <img src="{{ g.user.avatar_url }}" alt="Profile Picture" class="avatar avatar-sm"
                            onerror="this.onerror=null;this.src='{{ url_for('static', filename='user_icon.png') }}';">
                    </button>
                    <div class="dropdown-content">
                        <a href="{{ url_for('user.view_user', user_id=g.user['uid']) }}">ğŸ‘¤ My Profile</a>
                        <a href="{{ url_for('user.settings') }}">âš™ï¸ Settings</a>
                        {% if session.get('is_admin') %}
                        <a href="{{ url_for('admin.admin') }}">ğŸ‘‘ Admin</a>
                        {% endif %}
                        <div class="dropdown-divider"></div>
                        <a href="{% if config.get('ENV') == 'beta' %}https://github.com/brewmarsh/pickaladder/issues/new?title=[BETA]+Bug&body=Environment:+Beta{% else %}https://github.com/brewmarsh/pickaladder/issues/new{% endif %}" target="_blank">ğŸ› Report a Bug</a>
                        <div class="dropdown-divider"></div>
                        <a href="{{ url_for('auth.logout') }}">ğŸšª Logout</a>
                    </div>
                </div>
                {% else %}
                <div class="dropdown guest-mobile-menu">
                    <div class="dropdown-content">
                        <a href="{{ url_for('auth.login') }}">Login</a>
                        <a href="{{ url_for('auth.register') }}">Register</a>
                    </div>
                </div>
                {% endif %}
            </div>
        </nav>
        <!-- Mobile Menu -->
        <div id="myLinks" class="mobile-nav d-none d-lg-none">
            {% if g.user %}
            <a href="{{ url_for('user.dashboard') }}" class="mobile-nav-link"><i class="fas fa-home me-2"></i>
                Dashboard</a>
            <a href="{{ url_for('user.view_community') }}" class="mobile-nav-link" style="position: relative;">
                <i class="fas fa-users me-2"></i> Community
                {% if incoming_requests_count > 0 %}
                <span class="notification-badge"
                    style="position: absolute; right: 20px; top: 50%; transform: translateY(-50%);">{{
                    incoming_requests_count }}</span>
                {% endif %}
            </a>
            <a href="{{ url_for('group.view_groups') }}" class="mobile-nav-link"><i class="fas fa-layer-group me-2"></i>
                Groups</a>
            <a href="{{ url_for('tournament.list_tournaments') }}" class="mobile-nav-link"><i
                    class="fas fa-trophy me-2"></i> Tournaments</a>
            {% if g.user.is_admin %}
            <a href="{{ url_for('tournament.create_tournament') }}" class="mobile-nav-link"><i
                    class="fas fa-plus me-2"></i> New Tournament</a>
            {% endif %}
            <a href="{{ url_for('match.leaderboard') }}" class="mobile-nav-link"><i class="fas fa-chart-line me-2"></i>
                Leaderboard</a>
            <div class="mobile-nav-divider"></div>
            <a href="{{ url_for('user.view_user', user_id=g.user['uid']) }}" class="mobile-nav-link"><i
                    class="fas fa-user me-2"></i> My Profile</a>
            <a href="{{ url_for('user.settings') }}" class="mobile-nav-link"><i class="fas fa-cog me-2"></i>
                Settings</a>
            {% if session.get('is_admin') %}
            <a href="{{ url_for('admin.admin') }}" class="mobile-nav-link"><i class="fas fa-user-shield me-2"></i>
                Admin</a>
            {% endif %}
            <div class="mobile-nav-divider"></div>
            <a href="{% if config.get('ENV') == 'beta' %}https://github.com/brewmarsh/pickaladder/issues/new?title=[BETA]+Bug&body=Environment:+Beta{% else %}https://github.com/brewmarsh/pickaladder/issues/new{% endif %}" target="_blank" class="mobile-nav-link">ğŸ› Report a Bug</a>
            <a href="{{ url_for('auth.logout') }}" class="mobile-nav-link"><i class="fas fa-sign-out-alt me-2"></i>
                Logout</a>
            {% else %}
            <a href="{{ url_for('auth.login') }}" class="mobile-nav-link">Login</a>
            <a href="{{ url_for('auth.register') }}" class="mobile-nav-link">Register</a>
            {% endif %}
        </div>
    </div>
</header>
