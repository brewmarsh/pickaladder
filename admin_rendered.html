<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="IjBlYWY0NGNhMDQxNzBiNjU3ZjIyZGI4ZmYzYzVhNjFjNDgwYjIxOGIi.aY4NoQ.zQg-YB0WpKjAB11bvQHaFCizZuY">
    <title>pickaladder - Admin Panel</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Oswald:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="icon" href="/static/pickaladder_logo_64.png" type="image/png" sizes="64x64">
    <link rel="icon" href="/static/pickaladder_logo_128.png" type="image/png"
        sizes="128x128">
    <link rel="icon" href="/static/pickaladder_logo_256.png" type="image/png"
        sizes="256x256">
    <link rel="icon" href="/static/pickaladder_logo_512.png" type="image/png"
        sizes="512x512">
    <link rel="stylesheet" href="/static/css/variables.css">
    <link rel="stylesheet" href="/static/css/layout-utils.css">
    <link rel="stylesheet" href="/static/css/buttons.css">
    <link rel="stylesheet" href="/static/css/avatars.css">
    <link rel="stylesheet" href="/static/css/cards.css">
    <link rel="stylesheet" href="/static/css/data-displays.css">
    <link rel="stylesheet" href="/static/css/layout.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="/static/dark.css">
    <link rel="stylesheet" href="/static/mobile.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body >



<header class="header">
    <div class="container">
        <!-- Mobile Header -->
        <div class="d-flex justify-content-between align-items-center d-lg-none w-100">

<a href="/user/dashboard" class="navbar-brand" style="display: flex; align-items: center;">
    <img src="/static/pickaladder_logo_64.png" alt="pickaladder logo"
        style="height: 24px; margin-right: 8px;">
    pickaladder
</a>

            <button class="hamburger-menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>

        <!-- Desktop Navbar -->
        <nav class="navbar d-none d-lg-flex">

<a href="/user/dashboard" class="navbar-brand" style="display: flex; align-items: center;">
    <img src="/static/pickaladder_logo_64.png" alt="pickaladder logo"
        style="height: 24px; margin-right: 8px;">
    pickaladder
</a>

            <div class="navbar-menu">

                <a href="/user/dashboard"
                    class="nav-link ">üìà Dashboard</a>
                <a href="/user/community"
                    class="nav-link "
                    style="position: relative;">
                    üåç Community

                </a>
                <a href="/group/"
                    class="nav-link ">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Groups</a>
                <a href="/tournaments/"
                    class="nav-link "
                    style="position: relative;">
                    üéæ Tournaments

                </a>
                <a href="/match/leaderboard"
                    class="nav-link ">üèÜ Leaderboard</a>

            </div>
            <div class="navbar-user-controls">

                <div class="dropdown">
                    <button class="dropbtn">
                        <img src="https://api.dicebear.com/9.x/avataaars/svg?seed=admin" alt="Profile Picture" class="avatar avatar-sm"
                            onerror="this.onerror=null;this.src='/static/user_icon.png';">
                    </button>
                    <div class="dropdown-content">
                        <a href="/user/admin_uid">üë§ My Profile</a>
                        <a href="/user/settings">‚öôÔ∏è Settings</a>

                        <a href="/admin/">üëë Admin</a>

                        <div class="dropdown-divider"></div>
                        <a href="https://github.com/brewmarsh/pickaladder/issues/new" target="_blank">üêõ Report a Bug</a>
                        <div class="dropdown-divider"></div>
                        <a href="/auth/logout">üö™ Logout</a>
                    </div>
                </div>

            </div>
        </nav>
        <!-- Mobile Menu -->
        <div id="myLinks" class="mobile-nav d-none d-lg-none">

            <a href="/user/dashboard" class="mobile-nav-link"><i class="fas fa-home me-2"></i>
                Dashboard</a>
            <a href="/user/community" class="mobile-nav-link" style="position: relative;">
                <i class="fas fa-users me-2"></i> Community

            </a>
            <a href="/group/" class="mobile-nav-link"><i class="fas fa-layer-group me-2"></i>
                Groups</a>
            <a href="/tournaments/" class="mobile-nav-link"><i
                    class="fas fa-trophy me-2"></i> Tournaments</a>
            <a href="/match/leaderboard" class="mobile-nav-link"><i class="fas fa-chart-line me-2"></i>
                Leaderboard</a>
            <div class="mobile-nav-divider"></div>
            <a href="/user/admin_uid" class="mobile-nav-link"><i
                    class="fas fa-user me-2"></i> My Profile</a>
            <a href="/user/settings" class="mobile-nav-link"><i class="fas fa-cog me-2"></i>
                Settings</a>

            <a href="/admin/" class="mobile-nav-link"><i class="fas fa-user-shield me-2"></i>
                Admin</a>

            <div class="mobile-nav-divider"></div>
            <a href="https://github.com/brewmarsh/pickaladder/issues/new" target="_blank" class="mobile-nav-link">üêõ Report a Bug</a>
            <a href="/auth/logout" class="mobile-nav-link"><i class="fas fa-sign-out-alt me-2"></i>
                Logout</a>

        </div>
    </div>
</header>


    <div class="container mt-3">
        <div class="alert alert-&lt;MagicMock name=&#39;mock.document().get().to_dict().level&#39; id=&#39;139634015144464&#39;&gt; alert-dismissible fade show" role="alert">
            &lt;MagicMock name=&#39;mock.document().get().to_dict().announcement_text&#39; id=&#39;139634015562080&#39;&gt;
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
    </div>


    <div class="container">
        <main class="main-content">





<div class="page-header">
    <h1>Admin Panel</h1>
</div>

<!-- KPI Row -->
<div class="card-grid" style="margin-bottom: 24px;">
    <div class="card text-center">
        <i class="fas fa-users fa-2x mb-3" style="color: var(--primary-color);"></i>
        <h2 class="text-volt mb-1">150</h2>
        <p class="text-muted mb-0">Total Users</p>
    </div>
    <div class="card text-center">
        <i class="fas fa-trophy fa-2x mb-3" style="color: var(--primary-color);"></i>
        <h2 class="text-volt mb-1">5</h2>
        <p class="text-muted mb-0">Active Tournaments</p>
    </div>
    <div class="card text-center">
        <i class="fas fa-table-tennis fa-2x mb-3" style="color: var(--primary-color);"></i>
        <h2 class="text-volt mb-1">12</h2>
        <p class="text-muted mb-0">Recent Matches</p>
    </div>
</div>

<div class="card-grid">
    <!-- User Management -->
    <div class="card" style="grid-column: span 2;">
        <h3>User Management</h3>
        <div class="table-container">
            <table class="table-standard responsive-table">
                <thead>
                    <tr>
                        <th>User</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>

                </tbody>
            </table>
        </div>
    </div>

    <!-- System Message -->
    <div class="card">
        <h3>System Message</h3>
        <p>Broadcast a global announcement to all users.</p>
        <form action="/admin/announcement" method="post">
            <input type="hidden" name="csrf_token" value="IjBlYWY0NGNhMDQxNzBiNjU3ZjIyZGI4ZmYzYzVhNjFjNDgwYjIxOGIi.aY4NoQ.zQg-YB0WpKjAB11bvQHaFCizZuY">
            <div class="form-group mb-2">
                <label for="announcement_text">Message</label>
                <textarea id="announcement_text" name="announcement_text" class="form-control" rows="3"
                    required>&lt;MagicMock name=&#39;mock.document().get().to_dict().announcement_text&#39; id=&#39;139634015562080&#39;&gt;</textarea>
            </div>
            <div class="form-group mb-2">
                <label for="level">Level</label>
                <select id="level" name="level" class="form-control">
                    <option value="info" >Info (Blue)</option>
                    <option value="warning" >Warning (Yellow)</option>
                    <option value="danger" >Danger (Red)</option>
                </select>
            </div>
            <div class="form-group form-check mb-2">
                <input type="checkbox" id="is_active" name="is_active" class="form-check-input" checked>
                <label for="is_active" class="form-check-label">Active</label>
            </div>
            <button type="submit" class="btn btn-primary w-100">Update Announcement</button>
        </form>
    </div>

    <!-- Account Tools -->
    <div class="card">
        <h3>Account Tools</h3>
        <div style="display: flex; flex-direction: column; gap: 10px;">
            <a href="/admin/merge_players" class="btn btn-warning">Merge Players (Deep Merge)</a>
            <hr>
            <h4>Merge Ghost</h4>
            <form action="/admin/merge-ghost" method="post">
                <input type="hidden" name="csrf_token" value="IjBlYWY0NGNhMDQxNzBiNjU3ZjIyZGI4ZmYzYzVhNjFjNDgwYjIxOGIi.aY4NoQ.zQg-YB0WpKjAB11bvQHaFCizZuY">
                <div class="form-group">
                    <input type="text" name="target_user_id" class="form-control mb-2" placeholder="Real User ID"
                        required>
                    <input type="email" name="ghost_email" class="form-control mb-2" placeholder="Ghost Email" required>
                </div>
                <button type="submit" class="btn btn-secondary w-100">Merge Ghost</button>
            </form>
            <hr>
            <h4>Friend Graph</h4>
            <p class="small text-muted">Visualize user connections.</p>
            <button type="button" class="btn btn-secondary w-100" data-toggle="modal" data-target="#friendGraphModal">
                View Graph
            </button>
        </div>
    </div>

    <!-- Site Settings -->
    <div class="card">
        <h3>Site Settings</h3>
        <p>
            Email Verification:

            <strong class="text-danger">Disabled</strong>

        </p>
        <form action="/admin/toggle_email_verification" method="post" class="mb-3">
            <input type="hidden" name="csrf_token" value="IjBlYWY0NGNhMDQxNzBiNjU3ZjIyZGI4ZmYzYzVhNjFjNDgwYjIxOGIi.aY4NoQ.zQg-YB0WpKjAB11bvQHaFCizZuY">
            <button type="submit"
                class="btn btn-success w-100">
                Enable
            </button>
        </form>

        <hr>

        <h4>Project Links</h4>
        <div class="d-flex flex-column gap-2">
            <a href="https://github.com/brewmarsh/pickaladder/discussions" target="_blank"
                class="btn btn-sm btn-outline-primary">GitHub Discussions</a>
            <a href="https://github.com/brewmarsh/pickaladder/projects" target="_blank"
                class="btn btn-sm btn-outline-primary">Project Board</a>
            <a href="https://github.com/brewmarsh/pickaladder/settings" target="_blank"
                class="btn btn-sm btn-outline-secondary">Repo Settings</a>
        </div>
    </div>

    <!-- Danger Zone -->
    <div class="card border-danger">
        <h3 class="text-danger">Danger Zone</h3>
        <p class="small text-muted">Destructive administrative actions.</p>
        <div class="d-flex flex-column gap-2">
            <form action="/admin/generate_users" method="post">
                <input type="hidden" name="csrf_token" value="IjBlYWY0NGNhMDQxNzBiNjU3ZjIyZGI4ZmYzYzVhNjFjNDgwYjIxOGIi.aY4NoQ.zQg-YB0WpKjAB11bvQHaFCizZuY">
                <button type="submit" class="btn btn-outline-primary btn-sm w-100">Generate Test Users</button>
            </form>
            <form action="/admin/generate_matches" method="post">
                <input type="hidden" name="csrf_token" value="IjBlYWY0NGNhMDQxNzBiNjU3ZjIyZGI4ZmYzYzVhNjFjNDgwYjIxOGIi.aY4NoQ.zQg-YB0WpKjAB11bvQHaFCizZuY">
                <button type="submit" class="btn btn-outline-primary btn-sm w-100">Generate Test Matches</button>
            </form>

            <hr>

            <h4>Delete User by ID/Email</h4>
            <form action="/admin/delete_user" method="post"
                onsubmit="return confirm('Are you sure you want to delete this user? This action is irreversible.');">
                <input type="hidden" name="csrf_token" value="IjBlYWY0NGNhMDQxNzBiNjU3ZjIyZGI4ZmYzYzVhNjFjNDgwYjIxOGIi.aY4NoQ.zQg-YB0WpKjAB11bvQHaFCizZuY">
                <div class="form-group mb-2">
                    <input type="text" id="user_identifier" name="user_identifier" class="form-control form-control-sm"
                        placeholder="User ID or Email" required>
                </div>
                <button type="submit" class="btn btn-danger btn-sm w-100">Delete User</button>
            </form>
        </div>
    </div>
</div>

<!-- Friend Graph Modal -->
<div class="modal" id="friendGraphModal" tabindex="-1" role="dialog" aria-labelledby="friendGraphModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="friendGraphModalLabel">Friend Graph</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div id="friend-graph" style="height: 500px; background: #111;"></div>
            </div>
        </div>
    </div>
</div>

        </main>
    </div>

    <footer class="footer mt-auto py-3">
    <div class="container text-center">
        <span class="text-muted">
            &copy; 2026 pickaladder
            <span class="mx-2">|</span>
            0.9.47
        </span>
    </div>
</footer>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/js/main.js"></script>
    <script>

        function dismissToast(toast) {
            if (!toast || !toast.parentNode) return;
            toast.classList.add('fade-out');
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.remove();
                }
            }, 500);
        }

        function showToast(message, category = 'info', submissionId = null) {
            const toastContainer = document.querySelector('.toast-container');
            if (!toastContainer) return;

            const toastId = submissionId || `toast_${Date.now()}`;
            const autohide = category !== 'info'; // Don't autohide pending toasts
            const delay = 4000;

            let progressBar = '';
            if (category === 'info') {
                progressBar = '<div class="progress"><div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 100%"></div></div>';
            }

            const toastHTML = `
                <div class="toast show" id="${toastId}" role="alert" aria-live="assertive" aria-atomic="true">
                    <div class="toast-header">
                        <img src="/static/pickaladder_logo_64.png" class="rounded mr-2" alt="Logo" style="width: 20px; height: 20px;">
                        <strong class="mr-auto">pickaladder</strong>
                        <button type="button" class="ml-2 mb-1 close" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="toast-body">
                        ${message}
                        ${progressBar}
                    </div>
                </div>
            `;
            toastContainer.insertAdjacentHTML('beforeend', toastHTML);
            const newToast = document.getElementById(toastId);

            // Handle close button
            const closeBtn = newToast.querySelector('.close');
            closeBtn.onclick = () => dismissToast(newToast);

            // Auto-dismiss
            if (autohide) {
                setTimeout(() => dismissToast(newToast), delay);
            }

            return toastId;
        }

        function updateToast(toastId, message, category) {
            const toastElement = document.getElementById(toastId);
            if (!toastElement) return;

            const toastBody = toastElement.querySelector('.toast-body');

            // Remove progress bar
            const progressBar = toastBody.querySelector('.progress');
            if (progressBar) {
                progressBar.remove();
            }

            toastBody.innerHTML = message;

            // Add a retry button for failed submissions
            if (category === 'danger') {
                const retryButton = document.createElement('button');
                retryButton.className = 'btn btn-sm btn-link';
                retryButton.innerText = 'Retry';
                retryButton.onclick = function () {
                    window.optimisticSubmission.retrySubmission(toastId);
                };
                toastBody.appendChild(document.createElement('br'));
                toastBody.appendChild(retryButton);
            }

            // Start auto-dismiss now that it's no longer "pending"
            if (category !== 'info') {
                setTimeout(() => dismissToast(toastElement), 4000);
            }
        }

        document.addEventListener("click", (e) => {
            const row = e.target.closest(".clickable-row");
            if (row && row.dataset.href && !e.target.closest("a") && !e.target.closest("button") && !e.target.closest("input")) {
                window.location.href = row.dataset.href;
            }
        });

    </script>
    <script src="/static/js/navbar.js"></script>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "",
            authDomain: "pickaladder.firebaseapp.com",
            projectId: "pickaladder",
            storageBucket: "pickaladder.appspot.com",
            messagingSenderId: "402457219675",
            appId: "1:402457219675:web:a346e2dc0dfa732d31e57e",
            measurementId: "G-E28CXCXTSK"
        };
        // Intercept fetch to add the auth token
        const originalFetch = window.fetch;
        window.fetch = function (url, options) {
            const token = localStorage.getItem('firebaseIdToken');
            if (token) {
                options = options || {};
                options.headers = options.headers || {};
                options.headers['Authorization'] = 'Bearer ' + token;
            }
            return originalFetch(url, options);
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
    </script>


<script src="https://visjs.github.io/vis-network/standalone/umd/vis-network.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        var friendGraphModal = document.getElementById('friendGraphModal');
        var friendGraphBtn = document.querySelector('[data-target="#friendGraphModal"]');
        var closeBtn = friendGraphModal.querySelector('.close');

        if (friendGraphBtn) {
            friendGraphBtn.addEventListener('click', function () {
                friendGraphModal.style.display = 'block';
                fetch('/admin/friend_graph_data')
                    .then(response => response.json())
                    .then(data => {
                        var container = document.getElementById('friend-graph');
                        var options = {
                            nodes: {
                                shape: 'dot',
                                size: 16,
                                color: {
                                    background: '#00ff00',
                                    border: '#ffffff',
                                    highlight: { background: '#ffffff', border: '#00ff00' }
                                },
                                font: { color: '#ffffff' }
                            },
                            edges: {
                                color: '#444',
                                width: 2
                            },
                            physics: {
                                enabled: true,
                                barnesHut: { gravitationalConstant: -2000 }
                            }
                        };
                        var network = new vis.Network(container, data, options);
                    });
            });
        }

        if (closeBtn) {
            closeBtn.addEventListener('click', function () {
                friendGraphModal.style.display = 'none';
            });
        }

        window.addEventListener('click', function (event) {
            if (event.target == friendGraphModal) {
                friendGraphModal.style.display = 'none';
            }
        });
    });
</script>

</body>

</html>